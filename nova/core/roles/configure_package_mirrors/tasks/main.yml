---
- name: Not including tasks for Ansible networks OS...
  when: ansible_network_os is not defined
  block:
    - name: Including Windows Chocolatey mirror tasks...
      include_tasks: choco.yml
      when: ansible_os_family == "Windows"

    - name: Configuring Debian family sources.list
      when: ansible_os_family == "Debian"
      block:
        - name: Checking if apt backup exists...
          ansible.builtin.stat:
            path: /etc/apt/sources.list_backup
          register: apt_backup_file

        - name: Backing up existing sources.list
          ansible.builtin.copy:
            src: /etc/apt/sources.list
            dest: /etc/apt/sources.list_backup
            remote_src: true
          when: not apt_backup_file.stat.exists

        - name: Including Kali mirror tasks...
          include_tasks: kali.yml
          when:
            - ansible_distribution == "Kali"
            - package_mirror_kali_uri != {}

        - name: Including Ubuntu Jammy mirror tasks...
          include_tasks: jammy.yml
          when:
            - ansible_distribution_release == "jammy"
            - package_mirror_jammy_uri != {}

        - name: Including Ubuntu Focal mirror tasks...
          include_tasks: focal.yml
          when:
            - ansible_distribution_release == "focal"
            - package_mirror_focal_uri != {}
