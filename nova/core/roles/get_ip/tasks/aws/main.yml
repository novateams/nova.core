---
- name: Getting public IP for {{ custom_vm_name | default(vm_name) }}...
  when: machine_operations_aws_assign_public_ip
  block:
    - name: Getting IP for {{ custom_vm_name | default(vm_name) }}...
      amazon.aws.ec2_eip_info:
        filters:
          tag:inventory_hostname: "{{ inventory_hostname }}"
          tag:project_fullname: "{{ project_fullname | default('undefined_project') }}"
      register: eip_list
      delegate_to: localhost
      become: false

    - name: Setting connection_address fact...
      ansible.builtin.set_fact:
        connection_address: "{{ eip_list.addresses[0].public_ip | default(ansible_host if ansible_host is ansible.utils.ip else connection_address) }}"

- name: Printing {{ inventory_hostname }} IPs...
  ansible.builtin.debug:
    msg: |
      FQDN - {{ fqdn | default('NA') }}
      IPv4 - {{ egress_nic_ipv4 }}
      IPv6 - {{ egress_nic_ipv6 }}
      Connection - {{ eip_list.addresses[0].public_ip | default(ansible_host if ansible_host is ansible.utils.ip else connection_address) }}
