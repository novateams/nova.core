---
- name: Setting connection to SSH...
  ansible.builtin.set_fact:
    ansible_connection: ssh

# SSHD Configuration
# This to avoid errors when someone has more that 6 SSH keys in their agent
- name: Increasing SSHD MaxAuthTries to {{ template_os_configuration_increase_maxauthtries_value }}...
  ansible.builtin.lineinfile:
    path: /usr/share/vyos/templates/ssh/sshd_config.j2
    regexp: .*MaxAuthTries.*
    line: MaxAuthTries {{ template_os_configuration_increase_maxauthtries_value }}
  become: true
  when: template_os_configuration_increase_maxauthtries

- name: Setting connection back to {{ default_connection_plugin }}...
  ansible.builtin.set_fact:
    ansible_connection: "{{ default_connection_plugin }}"
